<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>货位管理</title>
    <link rel="stylesheet" type="text/css" href="/static/jquery-easyui-1.3.3/themes/default/easyui.css"></link>
    <link rel="stylesheet" type="text/css" href="/static/jquery-easyui-1.3.3/themes/icon.css"></link>
    <script type="text/javascript" src="/static/jquery-easyui-1.3.3/jquery.min.js"></script>
    <script type="text/javascript" src="/static/jquery-easyui-1.3.3/jquery.easyui.min.js"></script>
    <script type="text/javascript" src="/static/jquery-easyui-1.3.3/locale/easyui-lang-zh_CN.js"></script>
    <script type="text/javascript" src="/static/js/date.js"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $("#s_name").val(10);
            generateTable($("#s_name").val());
        });

        function generate() {
            var value = $("#s_name").val();
            if (value <= 0) {
                $.messager.alert("系统提示", "货位数量比如大于0");
                return;
            }
            generateTable($("#s_name").val());
        }

        function calculate() {
            var num = $("#s_name").val();
            var speed = $("#speed").val();
            speed = 2;
            if (null == num || null == speed || '' == num || '' == speed) {
                $.messager.alert("系统提示", "货位数量与取货速度为必填项");
                return;
            }
            $.get("/admin/position/calculate/" + num + "/" + speed, function (result) {
                $("#calc_sum").val(result.num);
                $("#dg").datagrid('loadData', result.jsonArray);
            }, "json");
        }

        function generateTable(num) {
            $.get("/admin/position/generate/" + num, function (result) {
                var data = [];
                for (let i = 1; i <= num; i++) {
                    var obj = {};
                    obj.columnName = i;
                    obj.columnComments = "货物" + i;
                    data.push(obj);
                }
                buildTitle(data, result);
            }, "json");
        }

        //构建动态表头
        function buildTitle(data, value) {
            var jsonStr = data;
            if (jsonStr) {
                var rows = jsonStr;
                var columns = new Array(), thead = "", options = {};
                if (rows) {
                    var w = 100 / rows.length;
                    w = 100;
                    for (var i = 0; i < rows.length; i++) {
                        thead += "{field:'" + rows[i].columnName + "',title:'" + rows[i].columnComments + "',width:" + w + "}";
                        if (i < rows.length - 1) {
                            thead += ",";
                        }
                    }
                    thead = "[[" + thead + "]]";
                    //重要的是下面这几行代码
                    options.columns = eval(thead);
                    $("#dg").datagrid(options);
                    $("#dg").datagrid('loadData', value);
                    $("#dg").datagrid("resize"); //一定要调用这个，其他任何方法都会失败
                }
            }
        }
    </script>
</head>
<body class="easyui-layout" style="padding-top: 2px">
<div data-options="region:'center'">
    <table id="dg" title="货位管理" class="easyui-datagrid" fitColumns="true" rownumbers="true" singleSelect="true"
           fit="true" toolbar="#tb">
    </table>
    <div id="tb">
        <div>
            &nbsp;货位数量：&nbsp;<input type="text" id="s_name" size="20"/>
            <a href="javascript:generate()" class="easyui-linkbutton" iconCls="icon-add"
               plain="true">生成</a>
<!--            取货速度：&nbsp;<input type="text" id="speed" size="20"/>-->
            <a href="javascript:calculate()" class="easyui-linkbutton" iconCls="icon-edit" plain="true">计算</a>
            <div style="float: right;">计算和：<input type="text" id="calc_sum" size="20" readonly/></div>
        </div>
    </div>
</div>
</body>
</html>